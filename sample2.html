<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/three@0.137.4/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.137.4/examples/js/controls/OrbitControls.js"></script>
</head>

<body>
    <script>
        // ページの読み込みを待つ
        window.addEventListener('DOMContentLoaded', init);

        var init = function () {

            var width = 800,
                height = 600;

            // レンダラーを作成 
            var renderer = new THREE.WebGLRenderer();
            document.body.appendChild(renderer.domElement);
            renderer.setSize(width, height);
            renderer.shadowMap.enabled = true;      // 影を有効にする

            // シーンを作成
            var scene = new THREE.Scene();

            // カメラを作成
            var camera = new THREE.PerspectiveCamera(45, width / height, 1, 1000);
            camera.position.set(1, 1, 5);  //位置を指定
            //camera.lookAt(0, 0, 0); //見つめる方向

            // カメラコントローラーを作成
            const controls = new THREE.OrbitControls(camera, document.body);

            // 平行光源
            var dirLight = new THREE.DirectionalLight(0xffffff);
            dirLight.position.set(5, 1, 5);     //位置を指定
            dirLight.castShadow = true;         // 平行光源の影を有効にする
            scene.add(dirLight);     // シーンに追加

            // 点光源
            var spotLight = new THREE.SpotLight(0xffffff, 1, 100, Math.PI / 20, 0.2);
            spotLight.position.set(0, 10, -15);
            spotLight.castShadow = true;    // 点光源の影を有効にする

            // 平行光源　補助
            var dirLight2 = new THREE.DirectionalLight(0x666666);
            dirLight2.position.set(-5, 1, 1);
            scene.add(dirLight2);

            // 座標表示
            //const gridHelper = new THREE.GridHelper(2, 10); // size, step
            //scene.add(gridHelper);
            const axisHelper = new THREE.AxisHelper(2); //軸の長さ　X：赤、Y：緑、z：青
            scene.add(axisHelper);

            // 箱を作成
            var material_red = new THREE.MeshPhongMaterial({ color: 0xff0000 });
            var material_yellow = new THREE.MeshPhongMaterial({ color: 0xffff00 });
            var material_wire = new THREE.MeshPhongMaterial({ color: 0x556542, wireframe:true });
            var material_gloss = new THREE.MeshStandardMaterial({ color: 0x0000ff, roughness: 0.3 });

            var torus = new THREE.TorusGeometry(1.5, 0.2, 12, 30)
            var torus = new THREE.Mesh(torus, material_gloss);
            torus.castShadow = true;
            torus.position.set(0, 0, 0.5);
            scene.add(torus);

            var box = new THREE.BoxGeometry(0.2, 3, 0.2);
            var box = new THREE.Mesh(box, material_red);
            box.castShadow = true;
            box.position.set(0, 0, 0.5);
            scene.add(box);

            var box2 = new THREE.BoxGeometry(3, 0.2, 0.2);
            var box2 = new THREE.Mesh(box2, material_wire);
            box2.castShadow = true;
            box2.position.set(0, 0, 0.5);
            scene.add(box2);

            var torusKnot = new THREE.TorusKnotGeometry(2, 0.3, 20, 6, 8, 5);
            var torusKnot = new THREE.Mesh(torusKnot, material_yellow);
            torusKnot.castShadow = true;
            torusKnot.position.set(-10, 0, -400);
            scene.add(torusKnot);
            let back = false;

            update();

            // ループイベント
            function update() {
                // レンダリング
                renderer.render(scene, camera);
                requestAnimationFrame(update);

                // 物体を回転させる
                torus.rotation.x += 0.01;
                torus.rotation.y += 0.01;

                box.rotation.x += 0.01;
                box.rotation.y += 0.01;
                box.rotation.z += 0.01;

                box2.rotation.x += 0.01;
                box2.rotation.y += 0.01;
                box2.rotation.z -= 0.01;

                torusKnot.rotation.y += 0.005;
                //　前進、後進の条件
                if (torusKnot.position.z > 20) {
                    back = true;
                } else if (torusKnot.position.z < -400) {
                    back = false;
                }
                // 前進、後進の設定
                if (!back) {
                    torusKnot.position.z += 0.75;
                } else {
                    torusKnot.position.z -= 0.75;
                }
            }
        }
    </script>
</body>
</html>
